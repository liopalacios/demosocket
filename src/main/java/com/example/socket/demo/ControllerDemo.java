package com.example.socket.demo;

import com.example.socket.demo.websocket1.WebsocketDemo;
import com.example.socket.demo.websocket2.WebsocketDemo2;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.websocket.ContainerProvider;
import javax.websocket.WebSocketContainer;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;
import java.net.URI;
import java.util.List;

@RestController
@RequestMapping("/api")
public class ControllerDemo {
    private WebSocketContainer container;
    private WebsocketDemo2 demo2;

    @GetMapping("/demo")
    public String findAllVehiculo() throws Exception {
        final String HOST = "sig.sutran.gob.pe";
        final int PUERTO = 5852;
        DataInputStream dis;
        DataOutputStream dos;
        String resp = "fff";
        try {
            Socket sc = new Socket(HOST,PUERTO);
            dis = new DataInputStream(sc.getInputStream());
            dos = new DataOutputStream(sc.getOutputStream());
            dos.writeUTF("trama|7d7ofE3UQw|F4F-963#-9.5777531#-77.027115#22.8#0.0#PA#2020-06-27 11:32:47#43197#2020-08-15 01:02:44.134#4361700632#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:53#43197#2020-08-15 01:02:44.153#4361700633#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:56#43197#2020-08-15 01:02:44.156#4361700634#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:32:59#43197#2020-08-15 01:02:44.16#4361700635#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:33:11#43197#2020-08-15 01:02:44.163#4361700636#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:14#43197#2020-08-15 01:02:44.166#4361700637#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:21#43197#2020-08-15 01:02:44.169#4361700638#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:30#43197#2020-08-15 01:02:44.171#4361700639#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:36#43197#2020-08-15 01:02:44.174#4361700640#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:47#43197#2020-08-15 01:02:44.176#4361700641#1&");
            resp = dis.readUTF();
            System.out.println("MENSAJE");
            System.out.println(resp);
            sc.close();
        }catch (IOException e){
            e.printStackTrace();
        }
        return resp;
    }
    @GetMapping("/demodos")
    public String findAllVehiculodos() throws Exception {
        this.container = ContainerProvider.getWebSocketContainer();
        this.demo2=new WebsocketDemo2();
        String re ="response";
        try {
            this.container.connectToServer(this.demo2,new URI("ws://sig.sutran.gob.pe"));
            this.demo2.send_message("trama|7d7ofE3UQw|F4F-963#-9.5777531#-77.027115#22.8#0.0#PA#2020-06-27 11:32:47#43197#2020-08-15 01:02:44.134#4361700632#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:53#43197#2020-08-15 01:02:44.153#4361700633#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:56#43197#2020-08-15 01:02:44.156#4361700634#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:32:59#43197#2020-08-15 01:02:44.16#4361700635#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:33:11#43197#2020-08-15 01:02:44.163#4361700636#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:14#43197#2020-08-15 01:02:44.166#4361700637#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:21#43197#2020-08-15 01:02:44.169#4361700638#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:30#43197#2020-08-15 01:02:44.171#4361700639#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:36#43197#2020-08-15 01:02:44.174#4361700640#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:47#43197#2020-08-15 01:02:44.176#4361700641#1&");
            //WebsocketDemo demo = new WebsocketDemo();
            //demo.connect();
            //demo.send_message("trama|7d7ofE3UQw|F4F-963#-9.5777531#-77.027115#22.8#0.0#PA#2020-06-27 11:32:47#43197#2020-08-15 01:02:44.134#4361700632#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:53#43197#2020-08-15 01:02:44.153#4361700633#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:56#43197#2020-08-15 01:02:44.156#4361700634#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:32:59#43197#2020-08-15 01:02:44.16#4361700635#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:33:11#43197#2020-08-15 01:02:44.163#4361700636#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:14#43197#2020-08-15 01:02:44.166#4361700637#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:21#43197#2020-08-15 01:02:44.169#4361700638#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:30#43197#2020-08-15 01:02:44.171#4361700639#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:36#43197#2020-08-15 01:02:44.174#4361700640#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:47#43197#2020-08-15 01:02:44.176#4361700641#1&");

        }catch (Exception e){
            e.printStackTrace();
        }
        return re;
    }
    @GetMapping("/demotres")
    public String findAllVehiculotres() throws Exception {
        this.container = ContainerProvider.getWebSocketContainer();
        this.demo2=new WebsocketDemo2();
        String re ="response";
        try {
            //this.container.connectToServer(this.demo2,new URI("ws://sig.sutran.gob.pe"));
            //this.demo2.send_message("trama|7d7ofE3UQw|F4F-963#-9.5777531#-77.027115#22.8#0.0#PA#2020-06-27 11:32:47#43197#2020-08-15 01:02:44.134#4361700632#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:53#43197#2020-08-15 01:02:44.153#4361700633#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:56#43197#2020-08-15 01:02:44.156#4361700634#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:32:59#43197#2020-08-15 01:02:44.16#4361700635#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:33:11#43197#2020-08-15 01:02:44.163#4361700636#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:14#43197#2020-08-15 01:02:44.166#4361700637#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:21#43197#2020-08-15 01:02:44.169#4361700638#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:30#43197#2020-08-15 01:02:44.171#4361700639#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:36#43197#2020-08-15 01:02:44.174#4361700640#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:47#43197#2020-08-15 01:02:44.176#4361700641#1&");
            WebsocketDemo demo = new WebsocketDemo();
            demo.connect();
            demo.send_message("trama|7d7ofE3UQw|F4F-963#-9.5777531#-77.027115#22.8#0.0#PA#2020-06-27 11:32:47#43197#2020-08-15 01:02:44.134#4361700632#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:53#43197#2020-08-15 01:02:44.153#4361700633#1&F4F-963#-9.5778379#-77.027168#22.8#0.0#PA#2020-06-27 11:32:56#43197#2020-08-15 01:02:44.156#4361700634#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:32:59#43197#2020-08-15 01:02:44.16#4361700635#1&F4F-963#-9.577837#-77.027176#335.2#0.0#PA#2020-06-27 11:33:11#43197#2020-08-15 01:02:44.163#4361700636#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:14#43197#2020-08-15 01:02:44.166#4361700637#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:21#43197#2020-08-15 01:02:44.169#4361700638#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:30#43197#2020-08-15 01:02:44.171#4361700639#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:36#43197#2020-08-15 01:02:44.174#4361700640#1&F4F-963#-9.5778379#-77.027176#115.4#0.0#PA#2020-06-27 11:33:47#43197#2020-08-15 01:02:44.176#4361700641#1&");

        }catch (Exception e){
            e.printStackTrace();
        }
        return re;
    }
}
